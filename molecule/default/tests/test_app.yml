---

file:
  {{ alertmanager_logger_bin_path }}:
    owner: {{ alertmanager_logger_user }}
    group: {{ alertmanager_logger_group }}
    exists: true
    filetype: directory

port:
# # Check port at IPv6
# # https://github.com/aelsabbahy/goss/issues/177
   tcp6:{{ alertmanager_logger_port }}:
     listening: true
     ip:
     - '::'

service:
  alertmanager_webhook_logger:
    enabled: true
    running: true 
user:
  {{ alertmanager_logger_user }}:
    exists: true
    groups:
      - {{ alertmanager_logger_group }}
    shell: /usr/sbin/nologin
group:
  {{ alertmanager_logger_group }}:
    exists: true

command:
  alerttest:
    exit-status: 0
    exec: 'curl -s -o /dev/null -w "%{http_code}\n" -X POST "http://localhost:6725" -H "accept: application/json" -H "Content-Type: application/json" -d "{ \"receiver\": \"test\", \"status\": \"firing\", \"alerts\": [ { \"status\": \"firing\", \"labels\": { \"alertname\": \"NodeExporter\", \"env\": \"production\", \"instance\": \"node1.summit\", \"job\": \"node_exporter\", \"notify_room\": \"test\", \"severity\": \"critical\", \"type\": \"nodeexporter\" }, \"annotations\": { \"description\": \"Node exporter down on node1.summit\", \"summary\": \"Node exporter down on node1.summit\" }, \"startsAt\": \"2020-09-16T07:38:01.586706006Z\", \"endsAt\": \"0001-01-01T00:00:00Z\", \"generatorURL\": \"\", \"fingerprint\": \"e4ad109767ee663e\" } ], \"groupLabels\": { \"alertname\": \"NodeExporter\" }, \"commonLabels\": { \"alertname\": \"NodeExporter\", \"job\": \"node_exporter\", \"severity\": \"critical\", \"type\": \"nodeexporter\" }, \"commonAnnotations\": {}, \"externalURL\": \"http://localhost:9093\", \"version\": \"4\", \"groupKey\": \"{}/{notify_room=~\\\"^(?:.*test.*)$\\\"}:{alertname=\\\"NodeExporter\\\"}\", \"truncatedAlerts\": 0}"'
    stdout:
      - '204'
    stderr: []
    timeout: 10000
    skip: false
